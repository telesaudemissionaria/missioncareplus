<!DOCTYPE html>
<html lang="pt-BR" id="html-lang">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Anamnese Simplificada - MissionCare Plus</title>
    
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body {
            font-family: 'Lexend', 'Noto Sans', sans-serif;
            --primary-color: #0d9488;
            --primary-color-light: #ccfbf1;
            padding-bottom: 80px; 
        }
        .lang-btn { padding: 0.25rem 0.5rem; border-radius: 9999px; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .lang-btn.active { border-color: var(--primary-color); background-color: white; }
        .question-block { margin-bottom: 2rem; }
        .question-title { font-size: 1.25rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem; }
        .input-field { width: 100%; padding: 1rem; font-size: 1.125rem; border-radius: 0.75rem; border: 1px solid #d1d5db; background-color: white; transition: border-color 0.2s, box-shadow 0.2s; }
        .input-field:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.3); }
        .choice-label { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; }
        .choice-label:has(input:checked) { background-color: var(--primary-color-light); border-color: var(--primary-color); }
        .choice-input { color: var(--primary-color); }
        #orientation-content h1, #orientation-content h2, #orientation-content h3 { font-weight: 700; color: #0f766e; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        #orientation-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; color: #4b5563;}
        .loader {
            width: 50px; aspect-ratio: 1; border-radius: 50%;
            border: 8px solid var(--primary-color); border-right-color: var(--primary-color-light);
            animation: l2 1s infinite linear;
        }
        @keyframes l2 {to{transform: rotate(1turn)}}
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    
    <div id="app-container" class="relative flex size-full min-h-screen flex-col max-w-4xl mx-auto bg-gray-50 shadow-lg">
        <div id="form-screen">
            <header class="sticky top-0 z-10 flex items-center bg-gray-50/80 p-4 pb-3 backdrop-blur-sm border-b border-gray-200">
                <h1 data-i18n="headerTitle" class="text-[#0e181b] text-xl font-bold leading-tight flex-1 text-center">Anamnese Adulto</h1>
                <div class="absolute top-3 right-3 flex space-x-1 bg-gray-200 p-1 rounded-full">
                    <button class="lang-btn" data-lang="pt" aria-label="Português (Brasil)">
                        <svg width="20" height="14" viewBox="0 0 20 14" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="20" height="14" fill="#009c3b"/><polygon points="10,2 16,7 10,12 4,7" fill="#ffdf00"/><circle cx="10" cy="7" r="2.6" fill="#3e4095"/></svg>
                    </button>
                    <button class="lang-btn" data-lang="es" aria-label="Español (España)">
                        <svg width="20" height="14" viewBox="0 0 20 14" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="20" height="14" fill="#c60b1e"/><rect y="4" width="20" height="6" fill="#ffc400"/></svg>
                    </button>
                    <button class="lang-btn" data-lang="en" aria-label="English (US)">
                        <svg width="20" height="14" viewBox="0 0 20 14" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="20" height="14" fill="#b22234"/><g fill="#fff"><rect y="1" width="20" height="1.5"/><rect y="4" width="20" height="1.5"/><rect y="7" width="20" height="1.5"/><rect y="10" width="20" height="1.5"/></g><rect width="8" height="6" fill="#3c3b6e"/></svg>
                    </button>
                </div>
            </header>
            <main class="flex-grow p-4">
                <div class="m-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-800 rounded-r-lg">
                    <strong data-i18n="emergencyWarning" class="font-bold">ATENÇÃO: EM CASO DE EMERGÊNCIA, PROCURE AJUDA IMEDIATAMENTE.</strong>
                </div>
                <form id="anamnesis-form" class="p-4">
                    <div class="question-block">
                        <label for="problema-principal" class="question-title" data-i18n="q1Title">1. Qual o principal problema ou sintoma?</label>
                        <textarea id="problema-principal" data-i18n-placeholder="q1Placeholder" placeholder="Ex: Dor de cabeça forte, febre alta..." class="input-field" rows="3"></textarea>
                    </div>
                    <div class="question-block">
                        <label for="inicio-sintomas" class="question-title" data-i18n="q2Title">2. Quando exatamente os sintomas começaram?</label>
                        <input type="text" id="inicio-sintomas" data-i18n-placeholder="q2Placeholder" placeholder="Ex: Há 3 dias, ontem à noite" class="input-field"/>
                    </div>
                    <fieldset class="question-block">
                        <legend class="question-title" data-i18n="q3Title">3. Os sintomas estão melhorando, piorando ou iguais?</legend>
                        <div class="space-y-3">
                            <label class="choice-label"><input type="radio" name="progressao-sintomas" value="Melhorando" class="choice-input form-radio"> <span data-i18n="q3Opt1">Melhorando</span></label>
                            <label class="choice-label"><input type="radio" name="progressao-sintomas" value="Piorando" class="choice-input form-radio"> <span data-i18n="q3Opt2">Piorando</span></label>
                            <label class="choice-label"><input type="radio" name="progressao-sintomas" value="Iguais" class="choice-input form-radio"> <span data-i18n="q3Opt3">Permanecem Iguais</span></label>
                        </div>
                    </fieldset>
                    <div class="question-block">
                        <label for="melhora-piora" class="question-title" data-i18n="q4Title">4. O que melhora ou piora o sintoma?</label>
                        <textarea id="melhora-piora" data-i18n-placeholder="q4Placeholder" placeholder="Ex: Repouso melhora, esforço piora..." class="input-field" rows="3"></textarea>
                    </div>
                     <fieldset class="question-block">
                        <legend class="question-title" data-i18n="q5Title">5. Possui alguma destas doenças crônicas?</legend>
                        <div class="space-y-3">
                             <label class="choice-label"><input type="checkbox" name="condicoes" value="Hipertensão" class="choice-input form-checkbox"/> <span data-i18n="q5Opt1">Hipertensão (Pressão alta)</span></label>
                             <label class="choice-label"><input type="checkbox" name="condicoes" value="Diabetes" class="choice-input form-checkbox"/> <span data-i18n="q5Opt2">Diabetes</span></label>
                             <label class="choice-label"><input type="checkbox" name="condicoes" value="Asma" class="choice-input form-checkbox"/> <span data-i18n="q5Opt3">Asma</span></label>
                             <label class="choice-label"><input type="checkbox" name="condicoes" value="Doença Cardíaca" class="choice-input form-checkbox"/> <span data-i18n="q5Opt4">Doença Cardíaca</span></label>
                             <label class="choice-label"><input type="checkbox" name="condicoes" value="Nenhuma" class="choice-input form-checkbox"/> <span data-i18n="q5Opt5">Nenhuma das opções</span></label>
                        </div>
                    </fieldset>
                    <div class="question-block">
                        <label for="medicamentos" class="question-title" data-i18n="q6Title">6. Usa algum medicamento de forma contínua?</label>
                        <textarea id="medicamentos" data-i18n-placeholder="q6Placeholder" placeholder="Ex: Losartana 50mg, Metformina..." class="input-field" rows="3"></textarea>
                    </div>
                    <div class="question-block">
                        <label for="alergias" class="question-title" data-i18n="q7Title">7. Possui alguma alergia conhecida?</label>
                        <textarea id="alergias" data-i18n-placeholder="q7Placeholder" placeholder="Ex: Alergia a Penicilina, camarão..." class="input-field" rows="3"></textarea>
                    </div>
                </form>
            </main>
        </div>
        
        <div id="results-screen" class="hidden">
            <header class="sticky top-0 z-10 flex items-center bg-gray-50/80 p-4 pb-3 backdrop-blur-sm border-b border-gray-200">
                <button id="back-to-form-btn" class="text-teal-600 hover:text-teal-800 absolute left-4">
                    <i class="fas fa-arrow-left fa-lg"></i>
                </button>
                <h1 data-i18n="resultsTitle" class="text-[#0e181b] text-xl font-bold flex-1 text-center">Recomendações da Análise</h1>
            </header>
            <main id="report-content" class="flex-grow p-4 space-y-6">
                <div id="orientation-content" class="prose max-w-none bg-white p-5 rounded-lg shadow-sm border border-gray-200"></div>
            </main>
        </div>
    </div>

    <div id="bottom-nav" class="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 h-[70px] flex justify-around items-center px-2 max-w-4xl mx-auto shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
        <a href="index.html" class="flex flex-col items-center justify-center text-gray-500 hover:text-teal-600 w-1/4">
            <i class="fas fa-home text-2xl"></i>
            <span data-i18n="navHome" class="text-xs font-medium">INÍCIO</span>
        </a>
        <button id="nav-generate-report-btn" class="flex flex-col items-center justify-center text-gray-500 hover:text-teal-600 w-1/4">
            <i class="fas fa-file-medical-alt text-2xl"></i>
            <span data-i18n="navAnalyze" class="text-xs font-medium">Gerar Análise</span>
        </button>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DEFINIÇÃO DAS TRADUÇÕES ---
    const translations = {
        en: {
            pageTitle: "Simplified Anamnesis - MissionCare Plus",
            headerTitle: "Adult Anamnesis",
            emergencyWarning: "ATTENTION: IN CASE OF EMERGENCY, SEEK HELP IMMEDIATELY.",
            q1Title: "1. What is the main problem or symptom?",
            q1Placeholder: "Ex: Severe headache, high fever...",
            q2Title: "2. When exactly did the symptoms start?",
            q2Placeholder: "Ex: 3 days ago, last night",
            q3Title: "3. Are the symptoms getting better, worse, or staying the same?",
            q3Opt1: "Getting better",
            q3Opt2: "Getting worse",
            q3Opt3: "Staying the same",
            q4Title: "4. What makes the symptom better or worse?",
            q4Placeholder: "Ex: Rest improves it, effort worsens it...",
            q5Title: "5. Do you have any of these chronic diseases?",
            q5Opt1: "Hypertension (High blood pressure)",
            q5Opt2: "Diabetes",
            q5Opt3: "Asthma",
            q5Opt4: "Heart Disease",
            q5Opt5: "None of the above",
            q6Title: "6. Do you use any medication continuously?",
            q6Placeholder: "Ex: Losartan 50mg, Metformin...",
            q7Title: "7. Do you have any known allergies?",
            q7Placeholder: "Ex: Allergic to Penicillin, shrimp...",
            resultsTitle: "Analysis Recommendations",
            navHome: "HOME",
            navAnalyze: "Analyze",
            loading: "Analyzing information...",
            errorTitle: "ERROR: Could not process analysis.",
            errorMessage: "There was a problem communicating with the server. Please try again later.",
        },
        es: {
            pageTitle: "Anamnesis Simplificada - MissionCare Plus",
            headerTitle: "Anamnesis Adulto",
            emergencyWarning: "ATENCIÓN: EN CASO DE EMERGENCIA, BUSQUE AYUDA INMEDIATAMENTE.",
            q1Title: "1. ¿Cuál es el principal problema o síntoma?",
            q1Placeholder: "Ej: Dolor de cabeza fuerte, fiebre alta...",
            q2Title: "2. ¿Cuándo empezaron exactamente los síntomas?",
            q2Placeholder: "Ej: Hace 3 días, anoche",
            q3Title: "3. ¿Los síntomas están mejorando, empeorando o siguen igual?",
            q3Opt1: "Mejorando",
            q3Opt2: "Empeorando",
            q3Opt3: "Siguen Igual",
            q4Title: "4. ¿Qué mejora o empeora el síntoma?",
            q4Placeholder: "Ej: El reposo mejora, el esfuerzo empeora...",
            q5Title: "5. ¿Tiene alguna de estas enfermedades crónicas?",
            q5Opt1: "Hipertensión (Presión alta)",
            q5Opt2: "Diabetes",
            q5Opt3: "Asma",
            q5Opt4: "Enfermedad Cardíaca",
            q5Opt5: "Ninguna de las opciones",
            q6Title: "6. ¿Usa algún medicamento de forma continua?",
            q6Placeholder: "Ej: Losartán 50mg, Metformina...",
            q7Title: "7. ¿Tiene alguna alergia conocida?",
            q7Placeholder: "Ej: Alergia a la Penicilina, camarones...",
            resultsTitle: "Recomendaciones del Análisis",
            navHome: "INICIO",
            navAnalyze: "Generar Análisis",
            loading: "Analizando la información...",
            errorTitle: "ERROR: No se pudo procesar el análisis.",
            errorMessage: "Hubo un problema de comunicación con el servidor. Por favor, inténtelo de nuevo más tarde.",
        },
        pt: {
            pageTitle: "Anamnese Simplificada - MissionCare Plus",
            headerTitle: "Anamnese Adulto",
            emergencyWarning: "ATENÇÃO: EM CASO DE EMERGÊNCIA, PROCURE AJUDA IMEDIATAMENTE.",
            q1Title: "1. Qual o principal problema ou sintoma?",
            q1Placeholder: "Ex: Dor de cabeça forte, febre alta...",
            q2Title: "2. Quando exatamente os sintomas começaram?",
            q2Placeholder: "Ex: Há 3 dias, ontem à noite",
            q3Title: "3. Os sintomas estão melhorando, piorando ou iguais?",
            q3Opt1: "Melhorando",
            q3Opt2: "Piorando",
            q3Opt3: "Permanecem Iguais",
            q4Title: "4. O que melhora ou piora o sintoma?",
            q4Placeholder: "Ex: Repouso melhora, esforço piora...",
            q5Title: "5. Possui alguma destas doenças crônicas?",
            q5Opt1: "Hipertensão (Pressão alta)",
            q5Opt2: "Diabetes",
            q5Opt3: "Asma",
            q5Opt4: "Doença Cardíaca",
            q5Opt5: "Nenhuma das opções",
            q6Title: "6. Usa algum medicamento de forma contínua?",
            q6Placeholder: "Ex: Losartana 50mg, Metformina...",
            q7Title: "7. Possui alguma alergia conhecida?",
            q7Placeholder: "Ex: Alergia a Penicilina, camarão...",
            resultsTitle: "Recomendações da Análise",
            navHome: "INÍCIO",
            navAnalyze: "Gerar Análise",
            loading: "Analisando informações...",
            errorTitle: "ERRO: Não foi possível processar a análise.",
            errorMessage: "Houve um problema ao comunicar com o servidor. Por favor, tente novamente mais tarde.",
        }
    };

    // --- LÓGICA DE INTERNACIONALIZAÇÃO (i18n) ---
    let currentLang = 'pt';

    const setLanguage = (lang) => {
        if (!translations[lang]) return;
        currentLang = lang;
        document.documentElement.lang = lang;

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            el.innerHTML = translations[lang][key] || el.innerHTML;
        });

        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            const key = el.getAttribute('data-i18n-placeholder');
            el.placeholder = translations[lang][key] || el.placeholder;
        });

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === lang);
        });
    };

    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            setLanguage(e.currentTarget.dataset.lang);
        });
    });


    // --- LÓGICA PRINCIPAL DA APLICAÇÃO ---
    const formScreen = document.getElementById('form-screen');
    const resultsScreen = document.getElementById('results-screen');
    const generateBtn = document.getElementById('nav-generate-report-btn');
    const backBtn = document.getElementById('back-to-form-btn');
    const orientationContent = document.getElementById('orientation-content');

    generateBtn.addEventListener('click', async () => {
        const getSelectedValues = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);
        
        const reportData = {
            'Problema Principal': document.getElementById('problema-principal').value,
            'Início dos Sintomas': document.getElementById('inicio-sintomas').value,
            'Progressão dos Sintomas': document.querySelector('input[name="progressao-sintomas"]:checked')?.value || 'Não informado',
            'O que melhora ou piora?': document.getElementById('melhora-piora').value,
            'Doenças Crônicas': getSelectedValues('condicoes').join(', ') || 'Nenhuma',
            'Medicamentos Contínuos': document.getElementById('medicamentos').value,
            'Alergias': document.getElementById('alergias').value,
        };

        let prompt = "Analise os seguintes dados de anamnese de um paciente adulto e forneça uma orientação clínica detalhada. Classifique a urgência (Baixa, Média, Alta), liste possíveis hipóteses diagnósticas (com justificativa), sugira uma conduta clara (incluindo autocuidado e quando procurar um médico), e liste sinais de alerta específicos que o paciente deve observar. Formate a resposta em markdown.\n\n";
        for (const [key, value] of Object.entries(reportData)) {
            if (value && value !== 'Não informado' && value.length > 0) {
                prompt += `- ${key}: ${value}\n`;
            }
        }

        formScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');
        orientationContent.innerHTML = `<div class="loader mx-auto my-8"></div><p class="text-center font-semibold text-gray-600">${translations[currentLang].loading}</p>`;

        try {
            const response = await fetch('https://missioncareplus-jca0.onrender.com/api/v1/assistente', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    tipo_assistente: 'clinica',
                    prompt: prompt
                })
            });

            if (!response.ok) {
                 const errorText = await response.text();
                 throw new Error(`Server error: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            if (data.response) {
                 orientationContent.innerHTML = window.marked.parse(data.response);
            } else {
                 throw new Error("API response in unexpected format.");
            }

        } catch (error) {
            console.error('Error generating report:', error);
            orientationContent.innerHTML = `<div class="text-center p-4 bg-red-100 text-red-800 rounded-lg">
                                                <p class="font-bold">${translations[currentLang].errorTitle}</p>
                                                <p class="mt-2">${translations[currentLang].errorMessage}</p>
                                                <p class="text-sm mt-2">Detail: ${error.message}</p>
                                            </div>`;
        }
    });

    backBtn.addEventListener('click', () => {
        resultsScreen.classList.add('hidden');
        formScreen.classList.remove('hidden');
        orientationContent.innerHTML = '';
    });

    // --- INICIALIZAÇÃO ---
    setLanguage(currentLang);
});
</script>
</body>
</html>
