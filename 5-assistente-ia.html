<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente IA - MissionCare Plus</title>
    
    <!-- Importação de Fontes e Tailwind CSS -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Scripts para modo offline -->
    <script src="/js/connection-manager.js"></script>
    <script src="/js/mode-switcher.js"></script>
    <script src="/js/sync-manager.js"></script>
    
    <style>
        body {
            font-family: 'Lexend', 'Noto Sans', sans-serif;
            --primary-color: #0d9488; /* Tailwind teal-600 */
            padding-bottom: 80px; /* Espaço para a barra de navegação inferior */
        }
        #chat-container {
            scroll-behavior: smooth;
        }
        /* Animação de "digitando" */
        .typing-indicator span {
            height: 8px; width: 8px; float: left; margin: 0 1px;
            background-color: #9ca3af; display: block; border-radius: 50%;
            opacity: 0.4; animation: 1s blink infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: .2s; }
        .typing-indicator span:nth-child(3) { animation-delay: .4s; }
        @keyframes blink { 50% { opacity: 1; } }
        /* Estilos para os cartões de ação */
        .action-card {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; background-color: #f9fafb; border: 1px solid #e5e7eb;
            border-radius: 1rem; padding: 1.5rem 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: pointer;
        }
        .action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
        }
        .action-card svg {
            width: 32px; height: 32px; color: var(--primary-color); margin-bottom: 0.75rem;
        }
        .action-card h3 {
            font-size: 1rem; font-weight: 600; color: #374151;
        }
        /* Estilos para o conteúdo formatado da IA */
        .ai-response-content p, .ai-response-content ul, .ai-response-content ol {
            margin-bottom: 0.75rem;
        }
        .ai-response-content p:last-child, .ai-response-content ul:last-child, .ai-response-content ol:last-child {
            margin-bottom: 0;
        }
        
        /* Estilos para o seletor de idioma */
        .lang-selector button img {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .lang-selector button.active img {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }
        .lang-selector button:not(.active) img {
            opacity: 0.6;
        }
        .lang-selector button:not(.active):hover img {
            opacity: 1;
        }
        
        /* Estilos para o indicador de conexão */
        .connection-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 100;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .connection-indicator.online {
            background-color: #d1fae5;
            color: #065f46;
        }
        .connection-indicator.offline {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .connection-indicator i {
            margin-right: 5px;
        }
        
        /* Estilos para notificações */
        .mode-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 80%;
            text-align: center;
        }
        .mode-notification.online {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .mode-notification.offline {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .mode-notification-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .mode-notification-text {
            display: flex;
            flex-direction: column;
        }
        .mode-notification-text strong {
            font-weight: 700;
        }
        .mode-notification-text small {
            font-size: 12px;
            opacity: 0.8;
        }
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        /* Estilos para modo offline */
        .offline-banner {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Estilos para perguntas frequentes offline */
        .faq-item {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        .faq-question {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; padding: 1rem; background-color: white;
            cursor: pointer; transition: background-color 0.2s ease;
            border-bottom: 1px solid #e5e7eb;
        }
        .faq-question:hover {
            background-color: #f9fafb;
        }
        .faq-question h3 {
            font-size: 1rem; font-weight: 600; color: #111827;
        }
        .faq-question svg {
            width: 20px; height: 20px; color: var(--primary-color);
            transition: transform 0.3s ease;
        }
        .faq-item.open .faq-question svg {
            transform: rotate(90deg);
        }
        .faq-answer {
            max-height: 0; overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            padding: 0 1rem;
        }
        .faq-item.open .faq-answer {
            max-height: 500px; padding: 1rem;
        }
    </style>
</head>
<body class="bg-white">
    <!-- Indicador de Conexão -->
    <div id="connection-indicator" class="connection-indicator online">
        <i class="fas fa-wifi"></i> Online
    </div>
    <!-- Container da Aplicação -->
    <div id="app-container" class="relative flex size-full min-h-screen flex-col bg-white">
        <!-- MODO ONLINE -->
        <div id="online-mode">
            <header class="sticky top-0 z-20 flex items-center justify-between bg-white/90 p-4 pb-3 backdrop-blur-sm border-b border-gray-200">
                <div class="w-1/4"></div> <!-- Espaçador à esquerda -->
                <h1 data-i18n="assistente_titulo" class="text-gray-800 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Assistente IA</h1>
                <!-- Seletor de Idioma -->
                <div class="lang-selector flex justify-end items-center gap-2 w-1/4">
                    <button data-lang="pt"><img src="https://flagcdn.com/w40/br.png" alt="Português" class="w-6 h-auto rounded-full"></button>
                    <button data-lang="es"><img src="https://flagcdn.com/w40/es.png" alt="Español" class="w-6 h-auto rounded-full"></button>
                    <button data-lang="en"><img src="https://flagcdn.com/w40/us.png" alt="English" class="w-6 h-auto rounded-full"></button>
                </div>
            </header>
            
            <!-- TELA INICIAL COM AÇÕES VISUAIS -->
            <div id="welcome-screen" class="p-4 flex-grow flex flex-col justify-center">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center size-16 bg-teal-600 rounded-full text-white font-bold text-2xl mb-4">IA</div>
                    <h2 data-i18n="welcome_ola" class="text-2xl font-bold text-gray-800">Olá! Sou seu assistente médico virtual.</h2>
                    <p data-i18n="welcome_ajuda" class="text-gray-500 mt-1">Estou aqui para dar a você orientações iniciais, sem substituir seu médico.</p>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div data-action="symptoms" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 data-i18n="acao_sintomas">Analisar Sintomas</h3>
                    </div>
                    <div data-action="med_info" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                        <h3 data-i18n="acao_remedio">Info de Remédio</h3>
                    </div>
                    <div data-action="first_aid" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                        <h3 data-i18n="acao_socorros">Primeiros Socorros</h3>
                    </div>
                </div>
            </div>
            
            <!-- TELA DE CHAT (Inicialmente oculta) -->
            <div id="chat-screen" class="hidden flex flex-col h-full">
                <!-- Área do Chat -->
                <main id="chat-container" class="flex-grow p-4 space-y-6 overflow-y-auto">
                    <!-- Mensagens serão adicionadas aqui -->
                </main>
                <!-- Barra de Input Fixa -->
                <footer class="bg-white/90 backdrop-blur-sm border-t border-gray-200 p-4">
                    <div class="flex w-full items-center rounded-full border-2 border-gray-200 focus-within:border-teal-600 transition-colors duration-200 bg-white">
                        <input id="chat-input" type="text" data-i18n-placeholder="input_placeholder" placeholder="Pergunte ao assistente médico..." class="form-input flex-grow bg-transparent border-none focus:ring-0 h-12 placeholder:text-gray-400 p-4 text-base"/>
                        <button id="send-btn" class="text-teal-600 hover:text-teal-800 p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M223.87,114l-168-95.89A16,16,0,0,0,32.93,37.32l31,90.47a.42.42,0,0,0,0,.1.3.3,0,0,0,0,.1l-31,90.67A16,16,0,0,0,48,240a16.14,16.14,0,0,0,7.92-2.1l167.91-96.05a16,16,0,0,0,.05-27.89ZM48,224l0-.09L78.14,136H136a8,8,0,0,0,0-16H78.22L48.06,32.12,48,32l168,95.83Z"></path></svg>
                        </button>
                    </div>
                    <p data-i18n="footer_aviso" class="text-gray-500 text-xs text-center pt-2 px-4">
                        As respostas são geradas por IA especializada e não substituem a avaliação de um profissional de saúde.
                    </p>
                </footer>
            </div>
        </div>
        
        <!-- MODO OFFLINE -->
        <div id="offline-mode" class="hidden">
            <header class="sticky top-0 z-20 flex items-center justify-between bg-white/90 p-4 pb-3 backdrop-blur-sm border-b border-gray-200">
                <div class="w-1/4"></div> <!-- Espaçador à esquerda -->
                <h1 data-i18n="assistente_titulo_offline" class="text-gray-800 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Assistente IA - Offline</h1>
                <!-- Seletor de Idioma -->
                <div class="lang-selector flex justify-end items-center gap-2 w-1/4">
                    <button data-lang="pt"><img src="https://flagcdn.com/w40/br.png" alt="Português" class="w-6 h-auto rounded-full"></button>
                    <button data-lang="es"><img src="https://flagcdn.com/w40/es.png" alt="Español" class="w-6 h-auto rounded-full"></button>
                    <button data-lang="en"><img src="https://flagcdn.com/w40/us.png" alt="English" class="w-6 h-auto rounded-full"></button>
                </div>
            </header>
            
            <div class="offline-banner m-4">
                <i class="fas fa-wifi-slash"></i>
                <span data-i18n="offlineModeActive">Modo Offline Ativado - Funcionalidades Limitadas</span>
            </div>
            
            <!-- TELA INICIAL OFFLINE -->
            <div id="welcome-screen-offline" class="p-4 flex-grow flex flex-col">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center size-16 bg-teal-600 rounded-full text-white font-bold text-2xl mb-4">IA</div>
                    <h2 data-i18n="welcome_ola" class="text-2xl font-bold text-gray-800">Olá! Sou seu assistente médico virtual.</h2>
                    <p data-i18n="welcome_ajuda_offline" class="text-gray-500 mt-1">Estou aqui para dar a você orientações iniciais, sem substituir seu médico. (Modo Offline)</p>
                </div>
                
                <div class="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                    <h3 class="text-lg font-bold text-yellow-800 mb-2" data-i18n="offlineInfoTitle">Informação Offline</h3>
                    <p data-i18n="offlineInfoText" class="text-yellow-700">
                        No modo offline, tenho acesso limitado a informações. Abaixo estão algumas perguntas frequentes e respostas pré-definidas que podem ajudar em situações comuns.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <div data-action="symptoms-offline" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <h3 data-i18n="acao_sintomas">Analisar Sintomas</h3>
                    </div>
                    <div data-action="med_info-offline" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                        <h3 data-i18n="acao_remedio">Info de Remédio</h3>
                    </div>
                    <div data-action="first_aid-offline" class="action-card">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                        <h3 data-i18n="acao_socorros">Primeiros Socorros</h3>
                    </div>
                </div>
                
                <!-- Seção de Perguntas Frequentes -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-3" data-i18n="faqTitle">Perguntas Frequentes</h3>
                    <div id="faq-container" class="space-y-3">
                        <!-- As perguntas serão preenchidas dinamicamente -->
                    </div>
                </div>
            </div>
            
            <!-- TELA DE CHAT OFFLINE -->
            <div id="chat-screen-offline" class="hidden flex flex-col h-full">
                <!-- Área do Chat Offline -->
                <main id="chat-container-offline" class="flex-grow p-4 space-y-6 overflow-y-auto">
                    <!-- Mensagens serão adicionadas aqui -->
                </main>
                <!-- Barra de Input Fixa Offline -->
                <footer class="bg-white/90 backdrop-blur-sm border-t border-gray-200 p-4">
                    <div class="flex w-full items-center rounded-full border-2 border-gray-200 focus-within:border-teal-600 transition-colors duration-200 bg-white">
                        <input id="chat-input-offline" type="text" data-i18n-placeholder="input_placeholder_offline" placeholder="Digite sua pergunta..." class="form-input flex-grow bg-transparent border-none focus:ring-0 h-12 placeholder:text-gray-400 p-4 text-base"/>
                        <button id="send-btn-offline" class="text-teal-600 hover:text-teal-800 p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M223.87,114l-168-95.89A16,16,0,0,0,32.93,37.32l31,90.47a.42.42,0,0,0,0,.1.3.3,0,0,0,0,.1l-31,90.67A16,16,0,0,0,48,240a16.14,16.14,0,0,0,7.92-2.1l167.91-96.05a16,16,0,0,0,.05-27.89ZM48,224l0-.09L78.14,136H136a8,8,0,0,0,0-16H78.22L48.06,32.12,48,32l168,95.83Z"></path></svg>
                        </button>
                    </div>
                    <p data-i18n="footer_aviso_offline" class="text-gray-500 text-xs text-center pt-2 px-4">
                        As respostas são baseadas em informações pré-armazenadas e não substituem a avaliação de um profissional de saúde.
                    </p>
                </footer>
            </div>
        </div>
    </div>
    
    <!-- BARRA DE NAVEGAÇÃO GLOBAL -->
    <nav class="fixed bottom-0 left-0 right-0 z-50 border-t border-gray-200 bg-white shadow-[0_-2px_5px_rgba(0,0,0,0.05)]">
        <div class="mx-auto flex h-16 max-w-4xl items-center justify-around">
            <button onclick="goBack()" class="flex h-full w-1/2 flex-col items-center justify-center text-gray-600 transition-colors hover:bg-gray-50 hover:text-teal-600">
                <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                <span data-i18n="nav_voltar" class="mt-1 text-xs font-bold uppercase tracking-wider">Voltar</span>
            </button>
            <div class="h-8 w-px bg-gray-200"></div>
            <a href="index.html" class="flex h-full w-1/2 flex-col items-center justify-center text-gray-600 transition-colors hover:bg-gray-50 hover:text-teal-600">
                <svg class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                <span data-i18n="nav_inicio" class="mt-1 text-xs font-bold uppercase tracking-wider">Início</span>
            </a>
        </div>
    </nav>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Elementos da UI
    const onlineMode = document.getElementById('online-mode');
    const offlineMode = document.getElementById('offline-mode');
    const welcomeScreen = document.getElementById('welcome-screen');
    const welcomeScreenOffline = document.getElementById('welcome-screen-offline');
    const chatScreen = document.getElementById('chat-screen');
    const chatScreenOffline = document.getElementById('chat-screen-offline');
    const chatContainer = document.getElementById('chat-container');
    const chatContainerOffline = document.getElementById('chat-container-offline');
    const chatInput = document.getElementById('chat-input');
    const chatInputOffline = document.getElementById('chat-input-offline');
    const sendBtn = document.getElementById('send-btn');
    const sendBtnOffline = document.getElementById('send-btn-offline');
    const actionCards = document.querySelectorAll('.action-card');
    const langButtons = document.querySelectorAll('.lang-selector button');
    const faqContainer = document.getElementById('faq-container');
    const connectionIndicator = document.getElementById('connection-indicator');
    
    // Estado da Aplicação
    let chatMode = 'general';
    let currentLanguage = 'pt';
    let isOnline = navigator.onLine;
    
    // Dados offline para FAQs
    const faqData = {
        pt: [
            {
                question: "O que fazer em caso de febre alta?",
                answer: "Em caso de febre alta (acima de 38.5°C), mantenha-se hidratado bebendo bastante água. Descanse em um ambiente fresco. Use medicamentos antitérmicos como paracetamol se disponíveis e apropriados. Se a febre persistir por mais de 3 dias ou se houver outros sintomas graves, procure atendimento médico."
            },
            {
                question: "Como tratar uma ferida pequena?",
                answer: "Lave a ferida com água limpa e sabão. Aplique um antisséptico se disponível. Cubra com um curativo limpo e seco. Troque o curativo diariamente e observe sinais de infecção como vermelhidão, inchaço ou pus. Se esses sinais aparecerem, procure ajuda médica."
            },
            {
                question: "O que fazer em caso de diarreia?",
                answer: "Em casos de diarreia, a prioridade é evitar a desidratação. Beba bastante água, soluções de reidratação oral ou chás. Evite alimentos gordurosos, lácteos e muito açucar. Se a diarreia persistir por mais de 2 dias, houver sangue nas fezes ou sinais de desidratação extrema, procure ajuda médica."
            },
            {
                question: "Como aliviar dor de cabeça comum?",
                answer: "Para dor de cabeça comum, tente descansar em um ambiente tranquilo e escuro. Aplique compressas frias ou quentes na testa ou nuca. Mantenha-se hidratado. Se necessário, use analgésicos como paracetamol ou ibuprofeno. Evite luzes brilhantes e ruídos altos. Se a dor de cabeça for severa, repentina ou acompanhada de outros sintomas, procure ajuda médica."
            }
        ],
        es: [
            {
                question: "¿Qué hacer en caso de fiebre alta?",
                answer: "En caso de fiebre alta (por encima de 38.5°C), manténgase hidratado bebiendo mucha agua. Descanse en un ambiente fresco. Use medicamentos antipiréticos como paracetamol si están disponibles y son apropiados. Si la fiebre persiste por más de 3 días o hay otros síntomas graves, busque atención médica."
            },
            {
                question: "¿Cómo tratar una herida pequeña?",
                answer: "Lave la herida con agua limpia y jabón. Aplique un antiséptico si está disponible. Cúbrala con un vendaje limpio y seco. Cambie el vendaje diariamente y observe signos de infección como enrojecimiento, hinchazón o pus. Si aparecen estos signos, busque ayuda médica."
            },
            {
                question: "¿Qué hacer en caso de diarrea?",
                answer: "En casos de diarrea, la prioridad es evitar la deshidratación. Beba mucha agua, soluciones de rehidratación oral o tés. Evite alimentos grasos, lácteos y muy azucarados. Si la diarrea persiste por más de 2 días, hay sangre en las heces o signos de deshidratación extrema, busque ayuda médica."
            },
            {
                question: "¿Cómo aliviar el dolor de cabeza común?",
                answer: "Para el dolor de cabeza común, intente descansar en un ambiente tranquilo y oscuro. Aplique compresas frías o calientes en la frente o nuca. Manténgase hidratado. Si es necesario, use analgésicos como paracetamol o ibuprofeno. Evite luces brillantes y ruidos altos. Si el dolor de cabeza es severo, repentino o acompañado de otros síntomas, busque ayuda médica."
            }
        ],
        en: [
            {
                question: "What to do in case of high fever?",
                answer: "In case of high fever (above 38.5°C), stay hydrated by drinking plenty of water. Rest in a cool environment. Use antipyretic medications like paracetamol if available and appropriate. If the fever persists for more than 3 days or if there are other severe symptoms, seek medical attention."
            },
            {
                question: "How to treat a small wound?",
                answer: "Wash the wound with clean water and soap. Apply an antiseptic if available. Cover with a clean, dry dressing. Change the dressing daily and watch for signs of infection such as redness, swelling, or pus. If these signs appear, seek medical help."
            },
            {
                question: "What to do in case of diarrhea?",
                answer: "In cases of diarrhea, the priority is to prevent dehydration. Drink plenty of water, oral rehydration solutions, or teas. Avoid fatty, dairy, and sugary foods. If diarrhea persists for more than 2 days, there is blood in the stool, or signs of severe dehydration, seek medical help."
            },
            {
                question: "How to relieve common headache?",
                answer: "For common headache, try to rest in a quiet, dark environment. Apply cold or warm compresses to your forehead or neck. Stay hydrated. If necessary, use pain relievers like paracetamol or ibuprofen. Avoid bright lights and loud noises. If the headache is severe, sudden, or accompanied by other symptoms, seek medical help."
            }
        ]
    };
    
    // Inicialização
    function init() {
        // Verificar status de conexão
        updateConnectionStatus();
        
        // Adicionar event listeners para mudança de conexão
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // Configurar interface baseada no status de conexão
        setupInterface();
        
        // Carregar FAQs
        loadFAQs();
        
        // Adicionar event listeners
        setupEventListeners();
    }
    
    // Atualizar status de conexão
    function updateConnectionStatus() {
        isOnline = navigator.onLine;
        
        if (isOnline) {
            connectionIndicator.classList.remove('offline');
            connectionIndicator.classList.add('online');
            connectionIndicator.innerHTML = '<i class="fas fa-wifi"></i> Online';
        } else {
            connectionIndicator.classList.remove('online');
            connectionIndicator.classList.add('offline');
            connectionIndicator.innerHTML = '<i class="fas fa-wifi-slash"></i> Offline';
        }
        
        setupInterface();
    }
    
    // Configurar interface baseada no status de conexão
    function setupInterface() {
        if (isOnline) {
            onlineMode.classList.remove('hidden');
            offlineMode.classList.add('hidden');
        } else {
            onlineMode.classList.add('hidden');
            offlineMode.classList.remove('hidden');
        }
    }
    
    // Carregar FAQs
    function loadFAQs() {
        faqContainer.innerHTML = '';
        
        const faqs = faqData[currentLanguage] || faqData.pt;
        
        faqs.forEach((faq, index) => {
            const faqItem = document.createElement('div');
            faqItem.className = 'faq-item';
            faqItem.innerHTML = `
                <div class="faq-question">
                    <h3>${faq.question}</h3>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>${faq.answer}</p>
                </div>
            `;
            
            faqItem.querySelector('.faq-question').addEventListener('click', () => {
                faqItem.classList.toggle('open');
            });
            
            faqContainer.appendChild(faqItem);
        });
    }
    
    // Configurar event listeners
    function setupEventListeners() {
        // Botões de ação (online)
        actionCards.forEach(card => {
            card.addEventListener('click', () => {
                const action = card.getAttribute('data-action');
                handleActionClick(action);
            });
        });
        
        // Botões de ação (offline)
        document.querySelectorAll('[data-action$="-offline"]').forEach(card => {
            card.addEventListener('click', () => {
                const action = card.getAttribute('data-action');
                handleOfflineActionClick(action);
            });
        });
        
        // Botões de idioma
        langButtons.forEach(button => {
            button.addEventListener('click', () => {
                const lang = button.getAttribute('data-lang');
                changeLanguage(lang);
            });
        });
        
        // Botão de envio (online)
        sendBtn.addEventListener('click', () => {
            sendMessage();
        });
        
        // Input de chat (online)
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Botão de envio (offline)
        sendBtnOffline.addEventListener('click', () => {
            sendOfflineMessage();
        });
        
        // Input de chat (offline)
        chatInputOffline.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendOfflineMessage();
            }
        });
    }
    
    // Lidar com cliques nos botões de ação (online)
    function handleActionClick(action) {
        welcomeScreen.classList.add('hidden');
        chatScreen.classList.remove('hidden');
        
        // Limpar histórico de chat
        chatContainer.innerHTML = '';
        
        // Configurar modo de chat
        chatMode = action;
        
        // Adicionar mensagem inicial baseada na ação
        let initialMessage = '';
        let initialPrompt = '';
        
        switch (action) {
            case 'symptoms':
                initialMessage = currentLanguage === 'pt' ? 'Por favor, descreva seus sintomas para que eu possa ajudar.' :
                                currentLanguage === 'es' ? 'Por favor, describa sus síntomas para que pueda ayudar.' :
                                'Please describe your symptoms so I can help.';
                initialPrompt = currentLanguage === 'pt' ? 'Você é um assistente médico virtual. O usuário vai descrever sintomas. Forneça orientações gerais, mas sempre lembre que você não substitui um médico real.' :
                                currentLanguage === 'es' ? 'Eres un asistente médico virtual. El usuario va a describir síntomas. Proporciona orientaciones generales, pero siempre recuerda que no sustituyes a un médico real.' :
                                'You are a virtual medical assistant. The user will describe symptoms. Provide general guidance, but always remember that you do not replace a real doctor.';
                break;
            case 'med_info':
                initialMessage = currentLanguage === 'pt' ? 'Qual medicamento você gostaria de saber mais?' :
                                currentLanguage === 'es' ? '¿Qué medicamento le gustaría saber más?' :
                                'Which medication would you like to know more about?';
                initialPrompt = currentLanguage === 'pt' ? 'Você é um assistente médico virtual. O usuário vai perguntar sobre medicamentos. Forneça informações gerais sobre usos, efeitos colaterais e precauções, mas sempre lembre que você não substitui um médico ou farmacêutico.' :
                                currentLanguage === 'es' ? 'Eres un asistente médico virtual. El usuario preguntará sobre medicamentos. Proporciona información general sobre usos, efectos secundarios y precauciones, pero siempre recuerda que no sustituyes a un médico o farmacéutico.' :
                                'You are a virtual medical assistant. The user will ask about medications. Provide general information about uses, side effects and precautions, but always remember that you do not replace a doctor or pharmacist.';
                break;
            case 'first_aid':
                initialMessage = currentLanguage === 'pt' ? 'Qual situação de primeiros socorros você precisa de ajuda?' :
                                currentLanguage === 'es' ? '¿Qué situación de primeros auxilios necesita ayuda?' :
                                'Which first aid situation do you need help with?';
                initialPrompt = currentLanguage === 'pt' ? 'Você é um assistente médico virtual especializado em primeiros socorros. O usuário vai perguntar sobre situações de emergência. Forneça instruções claras e passo a passo, mas sempre recomende buscar ajuda profissional quando apropriado.' :
                                currentLanguage === 'es' ? 'Eres un asistente médico virtual especializado en primeros auxilios. El usuario preguntará sobre situaciones de emergencia. Proporciona instrucciones claras paso a paso, pero siempre recomienda buscar ayuda profesional cuando sea apropiado.' :
                                'You are a virtual medical assistant specializing in first aid. The user will ask about emergency situations. Provide clear step-by-step instructions, but always recommend seeking professional help when appropriate.';
                break;
        }
        
        // Adicionar mensagem inicial ao chat
        addMessage('bot', initialMessage);
        

    }
    
    // Lidar com cliques nos botões de ação (offline)
    function handleOfflineActionClick(action) {
        welcomeScreenOffline.classList.add('hidden');
        chatScreenOffline.classList.remove('hidden');
        
        // Limpar histórico de chat
        chatContainerOffline.innerHTML = '';
        
        // Configurar modo de chat
        chatMode = action;
        
        // Adicionar mensagem inicial baseada na ação
        let initialMessage = '';
        
        switch (action) {
            case 'symptoms-offline':
                initialMessage = currentLanguage === 'pt' ? 'Por favor, descreva seus sintomas. Estou operando no modo offline com informações limitadas.' :
                                currentLanguage === 'es' ? 'Por favor, describa sus síntomas. Estoy operando en modo offline con información limitada.' :
                                'Please describe your symptoms. I am operating in offline mode with limited information.';
                break;
            case 'med_info-offline':
                initialMessage = currentLanguage === 'pt' ? 'Qual medicamento você gostaria de saber? Estou operando no modo offline com informações limitadas.' :
                                currentLanguage === 'es' ? '¿Qué medicamento le gustaría saber? Estoy operando en modo offline con información limitada.' :
                                'Which medication would you like to know about? I am operating in offline mode with limited information.';
                break;
            case 'first_aid-offline':
                initialMessage = currentLanguage === 'pt' ? 'Qual situação de primeiros socorros você precisa? Estou operando no modo offline com informações limitadas.' :
                                currentLanguage === 'es' ? '¿Qué situación de primeros auxilios necesita? Estoy operando en modo offline con información limitada.' :
                                'Which first aid situation do you need help with? I am operating in offline mode with limited information.';
                break;
        }
        
        // Adicionar mensagem inicial ao chat
        addOfflineMessage('bot', initialMessage);
    }
    
    // Mudar idioma
    function changeLanguage(lang) {
        currentLanguage = lang;
        
        // Atualizar botões de idioma
        langButtons.forEach(button => {
            if (button.getAttribute('data-lang') === lang) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
        
        // Recarregar FAQs
        loadFAQs();
        
        // Salvar preferência de idioma
        localStorage.setItem('language', lang);
    }
    
    // Configuração da API do MissionCare Plus Backend
    const backendUrl = "https://missioncare-plus-backend.onrender.com";
    
    // Enviar mensagem (online)
    async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        // Adicionar mensagem do usuário ao chat
        addMessage('user', message);
        
        // Limpar input
        chatInput.value = '';
        
        // Adicionar indicador de digitação
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'flex items-start space-x-3';
        typingIndicator.innerHTML = `
            <div class="flex-shrink-0">
                <div class="inline-flex items-center justify-center size-10 bg-teal-600 rounded-full text-white font-bold text-lg">IA</div>
            </div>
            <div class="flex-grow">
                <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        `;
        chatContainer.appendChild(typingIndicator);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        
        try {
            // Preparar contexto baseado no modo de chat
            let systemPrompt = '';
            switch (chatMode) {
                case 'symptoms':
                    systemPrompt = currentLanguage === 'pt' ? 
                        'Você é um assistente médico virtual especializado em sintomas. Forneça orientações gerais sobre sintomas, mas sempre lembre que você não substitui um médico real. Seja empático e claro nas explicações.' :
                        currentLanguage === 'es' ? 
                        'Eres un asistente médico virtual especializado en síntomas. Proporciona orientaciones generales sobre síntomas, pero siempre recuerda que no sustituyes a un médico real. Sé empático y claro en las explicaciones.' :
                        'You are a virtual medical assistant specializing in symptoms. Provide general guidance about symptoms, but always remember that you do not replace a real doctor. Be empathetic and clear in explanations.';
                    break;
                case 'med_info':
                    systemPrompt = currentLanguage === 'pt' ? 
                        'Você é um assistente médico virtual especializado em medicamentos. Forneça informações gerais sobre usos, efeitos colaterais e precauções, mas sempre lembre que você não substitui um médico ou farmacêutico. Seja preciso e cauteloso.' :
                        currentLanguage === 'es' ? 
                        'Eres un asistente médico virtual especializado en medicamentos. Proporciona información general sobre usos, efectos secundarios y precauciones, pero siempre recuerda que no sustituyes a un médico o farmacéutico. Sé preciso y cauteloso.' :
                        'You are a virtual medical assistant specializing in medications. Provide general information about uses, side effects and precautions, but always remember that you do not replace a doctor or pharmacist. Be accurate and cautious.';
                    break;
                case 'first_aid':
                    systemPrompt = currentLanguage === 'pt' ? 
                        'Você é um assistente médico virtual especializado em primeiros socorros. Forneça instruções claras e passo a passo para situações de emergência, mas sempre recomende buscar ajuda profissional quando apropriado. Seja direto e prático.' :
                        currentLanguage === 'es' ? 
                        'Eres un asistente médico virtual especializado en primeros auxilios. Proporciona instrucciones claras paso a paso para situaciones de emergencia, pero siempre recomienda buscar ayuda profesional cuando sea apropiado. Sé directo y práctico.' :
                        'You are a virtual medical assistant specializing in first aid. Provide clear step-by-step instructions for emergency situations, but always recommend seeking professional help when appropriate. Be direct and practical.';
                    break;
                default:
                    systemPrompt = currentLanguage === 'pt' ? 
                        'Você é um assistente médico virtual. Forneça orientações gerais sobre saúde, mas sempre lembre que você não substitui um médico real.' :
                        currentLanguage === 'es' ? 
                        'Eres un asistente médico virtual. Proporciona orientaciones generales sobre salud, pero siempre recuerda que no sustituyes a un médico real.' :
                        'You are a virtual medical assistant. Provide general guidance about health, but always remember that you do not replace a real doctor.';
            }
            
            // Enviar requisição para o backend usando o assistente de emergências
            const response = await fetch(`${backendUrl}/api/assistants/run/emergencias`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: `${systemPrompt}\n\nPergunta do usuário: ${message}\n\nResponda no idioma ${currentLanguage === 'pt' ? 'português' : currentLanguage === 'es' ? 'espanhol' : 'inglês'}.`
                })
            });
            
            const data = await response.json();
            
            // Remover indicador de digitação
            chatContainer.removeChild(typingIndicator);
            
            if (data.ok && data.text) {
                const botResponse = data.text;
                
                // Adicionar resposta do bot ao chat
                addMessage('bot', botResponse);
                

            } else {
                // Erro na resposta
                const errorMessage = currentLanguage === 'pt' ? 'Desculpe, ocorreu um erro ao processar sua solicitação. Tente novamente.' :
                                    currentLanguage === 'es' ? 'Lo siento, ocurrió un error al procesar su solicitud. Inténtelo de nuevo.' :
                                    'Sorry, an error occurred while processing your request. Please try again.';
                
                addMessage('bot', errorMessage);
            }
        } catch (error) {
            console.error('Erro ao enviar mensagem:', error);
            
            // Remover indicador de digitação
            chatContainer.removeChild(typingIndicator);
            
            // Mensagem de erro
            const errorMessage = currentLanguage === 'pt' ? 'Desculpe, não foi possível conectar ao servidor. Verifique sua conexão e tente novamente.' :
                                currentLanguage === 'es' ? 'Lo siento, no fue posible conectar con el servidor. Verifique su conexión e intente nuevamente.' :
                                'Sorry, it was not possible to connect to the server. Check your connection and try again.';
            
            addMessage('bot', errorMessage);
        }
    }
    
    // Enviar mensagem (offline)
    function sendOfflineMessage() {
        const message = chatInputOffline.value.trim();
        if (!message) return;
        
        // Adicionar mensagem do usuário ao chat
        addOfflineMessage('user', message);
        
        // Limpar input
        chatInputOffline.value = '';
        
        // Simular processamento
        setTimeout(() => {
            // Respostas offline baseadas em palavras-chave
            let response = '';
            
            if (chatMode === 'symptoms-offline') {
                if (message.toLowerCase().includes('febre') || message.toLowerCase().includes('fiebre') || message.toLowerCase().includes('fever')) {
                    response = currentLanguage === 'pt' ? 
                        'Para febre, mantenha-se hidratado, descanse e considere medicamentos antitérmicos como paracetamol se disponíveis. Se a febre persistir por mais de 3 dias ou for muito alta (acima de 39°C), procure ajuda médica.' :
                        currentLanguage === 'es' ?
                        'Para la fiebre, manténgase hidratado, descanse y considere medicamentos antipiréticos como paracetamol si están disponibles. Si la fiebre persiste por más de 3 días o es muy alta (por encima de 39°C), busque ayuda médica.' :
                        'For fever, stay hydrated, rest, and consider antipyretic medications like paracetamol if available. If the fever persists for more than 3 days or is very high (above 39°C), seek medical help.';
                } else if (message.toLowerCase().includes('dor') && message.toLowerCase().includes('cabeça') || 
                          message.toLowerCase().includes('dolor') && message.toLowerCase().includes('cabeza') ||
                          message.toLowerCase().includes('headache')) {
                    response = currentLanguage === 'pt' ? 
                        'Para dor de cabeça, tente descansar em um ambiente tranquilo e escuro. Aplique compressas frias na testa. Mantenha-se hidratado. Se a dor for intensa ou persistente, procure ajuda médica.' :
                        currentLanguage === 'es' ?
                        'Para el dolor de cabeza, intente descansar en un ambiente tranquilo y oscuro. Aplique compresas frías en la frente. Manténgase hidratado. Si el dolor es intenso o persistente, busque ayuda médica.' :
                        'For headache, try to rest in a quiet, dark environment. Apply cold compresses to your forehead. Stay hydrated. If the pain is intense or persistent, seek medical help.';
                } else {
                    response = currentLanguage === 'pt' ? 
                        'Estou operando no modo offline com informações limitadas. Para sintomas específicos, recomendo consultar um profissional de saúde quando possível. Enquanto isso, mantenha-se hidratado e descanse.' :
                        currentLanguage === 'es' ?
                        'Estoy operando en modo offline con información limitada. Para síntomas específicos, recomiendo consultar a un profesional de salud cuando sea posible. Mientras tanto, manténgase hidratado y descanse.' :
                        'I am operating in offline mode with limited information. For specific symptoms, I recommend consulting a healthcare professional when possible. In the meantime, stay hydrated and rest.';
                }
            } else if (chatMode === 'med_info-offline') {
                if (message.toLowerCase().includes('paracetamol') || message.toLowerCase().includes('acetaminofen')) {
                    response = currentLanguage === 'pt' ? 
                        'O paracetamol é usado para aliviar dor e reduzir febre. Dosagem usual para adultos: 500mg a 1000mg a cada 6 horas, não excedendo 4000mg por dia. Efeitos colaterais raros, mas pode causar danos ao fígado em doses excessivas. Não consuma álcool enquanto estiver tomando este medicamento.' :
                        currentLanguage === 'es' ?
                        'El paracetamol se usa para aliviar el dolor y reducir la fiebre. Dosis usual para adultos: 500mg a 1000mg cada 6 horas, sin exceder 4000mg por día. Efectos secundarios raros, pero puede causar daño hepático en dosis excesivas. No consuma alcohol mientras esté tomando este medicamento.' :
                        'Paracetamol is used to relieve pain and reduce fever. Usual adult dose: 500mg to 1000mg every 6 hours, not exceeding 4000mg per day. Rare side effects, but can cause liver damage in excessive doses. Do not consume alcohol while taking this medication.';
                } else if (message.toLowerCase().includes('ibuprofeno') || message.toLowerCase().includes('ibuprofen')) {
                    response = currentLanguage === 'pt' ? 
                        'O ibuprofeno é um anti-inflamatório usado para aliviar dor, reduzir febre e inflamação. Dosagem usual para adultos: 200mg a 400mg a cada 6-8 horas, não excedendo 1200mg por dia sem supervisão médica. Tome com alimentos para reduzir o risco de irritação gástrica. Não recomendado para pessoas com problemas renais ou úlceras.' :
                        currentLanguage === 'es' ?
                        'El ibuprofeno es un antiinflamatorio usado para aliviar el dolor, reducir la fiebre y la inflamación. Dosis usual para adultos: 200mg a 400mg cada 6-8 horas, sin exceder 1200mg por día sin supervisión médica. Tómelo con alimentos para reducir el riesgo de irritación gástrica. No recomendado para personas con problemas renales o úlceras.' :
                        'Ibuprofen is an anti-inflammatory used to relieve pain, reduce fever and inflammation. Usual adult dose: 200mg to 400mg every 6-8 hours, not exceeding 1200mg per day without medical supervision. Take with food to reduce the risk of gastric irritation. Not recommended for people with kidney problems or ulcers.';
                } else {
                    response = currentLanguage === 'pt' ? 
                        'Estou operando no modo offline com informações limitadas. Para informações específicas sobre medicamentos, consulte um profissional de saúde ou farmacêutico quando possível. Leia sempre a bula do medicamento.' :
                        currentLanguage === 'es' ?
                        'Estoy operando en modo offline con información limitada. Para información específica sobre medicamentos, consulte a un profesional de la salud o farmacéutico cuando sea posible. Lea siempre el prospecto del medicamento.' :
                        'I am operating in offline mode with limited information. For specific information about medications, consult a healthcare professional or pharmacist when possible. Always read the medication leaflet.';
                }
            } else if (chatMode === 'first_aid-offline') {
                if (message.toLowerCase().includes('corte') || message.toLowerCase().includes('ferida') || 
                    message.toLowerCase().includes('corte') || message.toLowerCase().includes('herida') ||
                    message.toLowerCase().includes('cut') || message.toLowerCase().includes('wound')) {
                    response = currentLanguage === 'pt' ? 
                        'Para cortes e feridas: 1) Lave as mãos. 2) Limpe a ferida com água limpa. 3) Aplique pressão para parar o sangramento. 4) Aplique um antisséptico se disponível. 5) Cubra com um curativo limpo. 6) Procure ajuda médica se a ferida for profunda, se não parar de sangrar ou se houver sinais de infecção.' :
                        currentLanguage === 'es' ?
                        'Para cortes y heridas: 1) Lávese las manos. 2) Limpie la herida con agua limpia. 3) Aplique presión para detener el sangrado. 4) Aplique un antiséptico si está disponible. 5) Cúbrala con un vendaje limpio. 6) Busque ayuda médica si la herida es profunda, si no detiene el sangrado o si hay signos de infección.' :
                        'For cuts and wounds: 1) Wash your hands. 2) Clean the wound with clean water. 3) Apply pressure to stop bleeding. 4) Apply an antiseptic if available. 5) Cover with a clean dressing. 6) Seek medical help if the wound is deep, if it doesn\'t stop bleeding, or if there are signs of infection.';
                } else if (message.toLowerCase().includes('queimadura') || message.toLowerCase().includes('quemadura') || 
                          message.toLowerCase().includes('burn')) {
                    response = currentLanguage === 'pt' ? 
                        'Para queimaduras leves: 1) Resfrie a área com água corrente por 10-15 minutos. 2) Não aplique gelo diretamente. 3) Não use manteiga ou outros remédios caseiros. 4) Cubra com um curativo estéril. 5) Tome analgésicos se necessário. Para queimaduras graves, procure ajuda médica imediatamente.' :
                        currentLanguage === 'es' ?
                        'Para quemaduras leves: 1) Enfríe el área con agua corriente durante 10-15 minutos. 2) No aplique hielo directamente. 3) No use mantequilla u otros remedios caseros. 4) Cúbrala con un vendaje estéril. 5) Tome analgésicos si es necesario. Para quemaduras graves, busque ayuda médica inmediatamente.' :
                        'For minor burns: 1) Cool the area with running water for 10-15 minutes. 2) Do not apply ice directly. 3) Do not use butter or other home remedies. 4) Cover with a sterile dressing. 5) Take pain relievers if necessary. For severe burns, seek medical help immediately.';
                } else {
                    response = currentLanguage === 'pt' ? 
                        'Estou operando no modo offline com informações limitadas. Para situações de emergência, procure ajuda médica o mais rápido possível. Enquanto isso, mantenha a calma e tente manter a vítima segura e confortável.' :
                        currentLanguage === 'es' ?
                        'Estoy operando en modo offline con información limitada. Para situaciones de emergencia, busque ayuda médica lo más rápido posible. Mientras tanto, mantenga la calma e intente mantener a la víctima segura y cómoda.' :
                        'I am operating in offline mode with limited information. For emergency situations, seek medical help as quickly as possible. In the meantime, stay calm and try to keep the victim safe and comfortable.';
                }
            } else {
                response = currentLanguage === 'pt' ? 
                    'Estou operando no modo offline com informações limitadas. Para assistência médica completa, por favor, conecte-se à internet ou consulte um profissional de saúde.' :
                    currentLanguage === 'es' ?
                    'Estoy operando en modo offline con información limitada. Para asistencia médica completa, por favor, conéctese a internet o consulte a un profesional de la salud.' :
                    'I am operating in offline mode with limited information. For complete medical assistance, please connect to the internet or consult a healthcare professional.';
            }
            
            // Adicionar resposta do bot ao chat
            addOfflineMessage('bot', response);
        }, 1000);
    }
    
    // Adicionar mensagem ao chat (online)
    function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex items-start space-x-3 ${sender === 'user' ? 'justify-end' : ''}`;
        
        if (sender === 'user') {
            messageDiv.innerHTML = `
                <div class="flex-grow text-right">
                    <div class="bg-teal-600 text-white rounded-2xl rounded-tr-none p-4 max-w-[80%] inline-block">
                        <p class="whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <div class="inline-flex items-center justify-center size-10 bg-gray-200 rounded-full text-gray-700 font-bold text-lg">EU</div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="flex-shrink-0">
                    <div class="inline-flex items-center justify-center size-10 bg-teal-600 rounded-full text-white font-bold text-lg">IA</div>
                </div>
                <div class="flex-grow">
                    <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                        <div class="ai-response-content">${formatResponse(text)}</div>
                    </div>
                </div>
            `;
        }
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Adicionar mensagem ao chat (offline)
    function addOfflineMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex items-start space-x-3 ${sender === 'user' ? 'justify-end' : ''}`;
        
        if (sender === 'user') {
            messageDiv.innerHTML = `
                <div class="flex-grow text-right">
                    <div class="bg-teal-600 text-white rounded-2xl rounded-tr-none p-4 max-w-[80%] inline-block">
                        <p class="whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <div class="inline-flex items-center justify-center size-10 bg-gray-200 rounded-full text-gray-700 font-bold text-lg">EU</div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="flex-shrink-0">
                    <div class="inline-flex items-center justify-center size-10 bg-teal-600 rounded-full text-white font-bold text-lg">IA</div>
                </div>
                <div class="flex-grow">
                    <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                        <div class="ai-response-content">${formatResponse(text)}</div>
                    </div>
                </div>
            `;
        }
        
        chatContainerOffline.appendChild(messageDiv);
        chatContainerOffline.scrollTop = chatContainerOffline.scrollHeight;
    }
    
    // Formatar resposta da IA
    function formatResponse(text) {
        // Converter quebras de linha em <br>
        let formatted = text.replace(/\n/g, '<br>');
        
        // Converter listas simples
        formatted = formatted.replace(/^-\s+(.+)$/gm, '<li>$1</li>');
        formatted = formatted.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
        
        return formatted;
    }
    
    // Carregar idioma salvo
    const savedLanguage = localStorage.getItem('language');
    if (savedLanguage && ['pt', 'es', 'en'].includes(savedLanguage)) {
        currentLanguage = savedLanguage;
    }
    
    // Atualizar botões de idioma
    langButtons.forEach(button => {
        if (button.getAttribute('data-lang') === currentLanguage) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
    
    // Inicializar aplicação
    init();
});

// Função global para voltar
function goBack() {
    if (!document.getElementById('chat-screen').classList.contains('hidden')) {
        // Se estiver na tela de chat online, voltar para a tela de boas-vindas online
        document.getElementById('chat-screen').classList.add('hidden');
        document.getElementById('welcome-screen').classList.remove('hidden');
    } else if (!document.getElementById('chat-screen-offline').classList.contains('hidden')) {
        // Se estiver na tela de chat offline, voltar para a tela de boas-vindas offline
        document.getElementById('chat-screen-offline').classList.add('hidden');
        document.getElementById('welcome-screen-offline').classList.remove('hidden');
    } else {
        // Se estiver em qualquer outra tela, voltar para a página inicial
        window.location.href = 'index.html';
    }
}
</script>
</body>
</html>
