
<!DOCTYPE html>
<html lang="pt-BR" data-current-lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergências - MissionCare Plus</title>
    
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Lexend:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body { font-family: 'Lexend', 'Noto Sans', sans-serif; padding-bottom: 80px; }
        .emergency-btn {
            border: 2px solid #dc2626; background-color: #fee2e2; color: #991b1b;
            transition: all 0.2s ease-in-out;
        }
        .emergency-btn:hover { background-color: #dc2626; color: white; transform: translateY(-2px); }
        .loader {
            width: 50px; aspect-ratio: 1; border-radius: 50%;
            border: 8px solid #dc2626; border-right-color: #fee2e2;
            animation: l2 1s infinite linear;
        }
        @keyframes l2 {to{transform: rotate(1turn)}}
        
        /* Language switcher styles */
        .lang-switcher button {
            background-color: #f3f4f6; border: 1px solid #d1d5db; color: #4b5563;
            padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-weight: 500;
            transition: all 0.2s ease;
        }
        .lang-switcher button.active {
            background-color: #dc2626; color: white; border-color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="app-container" class="relative flex flex-col size-full min-h-screen max-w-4xl mx-auto bg-gray-50 shadow-lg">
        
        <header class="sticky top-0 z-10 grid grid-cols-3 items-center bg-gray-50/90 p-4 backdrop-blur-sm border-b border-gray-200">
            <div class="flex justify-start">
                 <button id="back-to-main" class="text-gray-600 hover:text-red-600 hidden w-10 h-10">
                    <i class="fas fa-arrow-left fa-lg"></i>
                </button>
                <a href="index.html" class="text-gray-600 hover:text-red-600 w-10 h-10 flex items-center justify-center" title="Início">
                    <i class="fas fa-home fa-lg"></i>
                </a>
            </div>
            <h1 data-translate="pageTitle" class="text-gray-800 text-xl font-bold leading-tight text-center">Assistente de Emergência</h1>
            <div class="lang-switcher flex justify-end items-center space-x-1">
                <button data-lang="pt" class="active">PT</button>
                <button data-lang="en">EN</button>
                <button data-lang="es">ES</button>
            </div>
        </header>

        <main class="flex-grow p-4 md:p-6">
            <div id="main-view">
                <div id="interactive-view" class="bg-white p-4 rounded-xl shadow-md border border-gray-200">
                    <h2 data-translate="subtitle" class="text-center text-xl font-semibold text-gray-800 mb-4">Qual é a emergência?</h2>
                    <div id="critical-buttons" class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                        <button data-key="chestPain" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-heart-pulse text-3xl mb-2"></i>
                            <span data-translate="chestPain">Dor forte no peito agora</span>
                        </button>
                        <button data-key="stroke" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-brain text-3xl mb-2"></i>
                            <span data-translate="stroke">Fraqueza face/braço ou fala alterada</span>
                        </button>
                        <button data-key="breathing" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-lungs text-3xl mb-2"></i>
                            <span data-translate="breathing">Respiração muito difícil agora</span>
                        </button>
                        <button data-key="bleeding" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-tint text-3xl mb-2"></i>
                            <span data-translate="bleeding">Sangramento incontrolável</span>
                        </button>
                        <button data-key="allergy" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-allergies text-3xl mb-2"></i>
                            <span data-translate="allergy">Reação alérgica grave</span>
                        </button>
                        <button data-key="fainting" class="emergency-btn p-4 rounded-lg flex flex-col items-center justify-center text-center font-semibold">
                            <i class="fas fa-bolt text-3xl mb-2"></i>
                            <span data-translate="fainting">Desmaio / Convulsão / Confusão</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="results-container" class="hidden">
                 <div id="response-content" class="prose max-w-none p-5 bg-white rounded-lg shadow-lg border border-gray-200"></div>
            </div>
        </main>
        
        <nav class="fixed bottom-0 left-0 right-0 z-50 border-t border-gray-200 bg-white">
          <div class="mx-auto flex h-16 max-w-4xl items-center justify-around">
            <a href="index.html" class="flex h-full w-full flex-col items-center justify-center text-gray-600 hover:bg-gray-50 hover:text-teal-600">
              <i class="fas fa-home text-2xl"></i>
              <span data-translate="navHome" class="mt-1 text-xs font-bold uppercase">Início</span>
            </a>
          </div>
        </nav>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const translations = {
        pt: {
            pageTitle: "Assistente de Emergência",
            subtitle: "Qual é a emergência?",
            navHome: "Início",
            loading: "Buscando instruções...",
            errorTitle: "Erro de Comunicação",
            errorMessage: "Não foi possível obter as instruções. Verifique sua conexão e tente novamente.",
            chestPain: "Dor forte no peito agora",
            stroke: "Fraqueza face/braço ou fala alterada",
            breathing: "Respiração muito difícil agora",
            bleeding: "Sangramento incontrolável",
            allergy: "Reação alérgica grave",
            fainting: "Desmaio / Convulsão / Confusão",
            prompts: {
                chestPain: "Instruções de primeiros socorros para dor forte no peito, possível infarto.",
                stroke: "Instruções de primeiros socorros para fraqueza súbita na face, braço ou perna, ou fala alterada, possível AVC.",
                breathing: "Instruções de primeiros socorros para respiração com muita dificuldade, possível asfixia ou crise grave.",
                bleeding: "Instruções de primeiros socorros para sangramento incontrolável, vômito com sangue vivo ou fezes pretas como piche.",
                allergy: "Instruções de primeiros socorros para reação alérgica grave com inchaço na garganta ou falta de ar, possível anafilaxia.",
                fainting: "Instruções de primeiros socorros para desmaio, convulsão ou confusão mental grave."
            }
        },
        en: {
            pageTitle: "Emergency Assistant",
            subtitle: "What is the emergency?",
            navHome: "Home",
            loading: "Fetching instructions...",
            errorTitle: "Communication Error",
            errorMessage: "Could not get instructions. Check your connection and try again.",
            chestPain: "Severe chest pain now",
            stroke: "Face/arm weakness or altered speech",
            breathing: "Very difficult breathing now",
            bleeding: "Uncontrollable bleeding",
            allergy: "Severe allergic reaction",
            fainting: "Fainting / Seizure / Confusion",
            prompts: {
                chestPain: "First aid instructions for severe chest pain, possible heart attack.",
                stroke: "First aid instructions for sudden weakness in the face, arm, or leg, or altered speech, possible stroke.",
                breathing: "First aid instructions for a person with severe difficulty breathing, possible choking or severe crisis.",
                bleeding: "First aid instructions for uncontrollable bleeding, vomiting bright red blood, or tar-like black stools.",
                allergy: "First aid instructions for a severe allergic reaction with throat swelling or shortness of breath, possible anaphylaxis.",
                fainting: "First aid instructions for fainting, seizure, or severe mental confusion."
            }
        },
        es: {
            pageTitle: "Asistente de Emergencia",
            subtitle: "¿Cuál es la emergencia?",
            navHome: "Inicio",
            loading: "Buscando instrucciones...",
            errorTitle: "Error de Comunicación",
            errorMessage: "No se pudieron obtener las instrucciones. Verifique su conexión e intente de nuevo.",
            chestPain: "Dolor de pecho fuerte ahora",
            stroke: "Debilidad facial/brazo o habla alterada",
            breathing: "Respiración muy difícil ahora",
            bleeding: "Sangrado incontrolable",
            allergy: "Reacción alérgica grave",
            fainting: "Desmayo / Convulsión / Confusión",
            prompts: {
                chestPain: "Instrucciones de primeros auxilios para dolor severo en el pecho, posible infarto.",
                stroke: "Instrucciones de primeros auxilios para debilidad súbita en la cara, brazo o pierna, o habla alterada, posible ACV.",
                breathing: "Instrucciones de primeros auxilios para una persona con dificultad respiratoria severa, posible asfixia o crisis grave.",
                bleeding: "Instrucciones de primeros auxilios para sangrado incontrolable, vómito con sangre roja brillante o heces negras como el alquitrán.",
                allergy: "Instrucciones de primeros auxilios para una reacción alérgica grave con hinchazón de garganta o falta de aire, posible anafilaxia.",
                fainting: "Instrucciones de primeros auxilios para desmayo, convulsión o confusión mental grave."
            }
        }
    };

    const mainView = document.getElementById('main-view');
    const resultsContainer = document.getElementById('results-container');
    const responseContent = document.getElementById('response-content');
    const criticalButtons = document.getElementById('critical-buttons');
    const backToMainBtn = document.getElementById('back-to-main');
    const langSwitcher = document.querySelector('.lang-switcher');

    function updateLanguage(lang) {
        document.documentElement.setAttribute('data-current-lang', lang);
        const langTexts = translations[lang];
        
        document.querySelectorAll('[data-translate]').forEach(el => {
            const key = el.dataset.translate;
            if (langTexts[key]) {
                el.textContent = langTexts[key];
            }
        });
        
        langSwitcher.querySelector('button.active').classList.remove('active');
        langSwitcher.querySelector(`button[data-lang="${lang}"]`).classList.add('active');
    }

    langSwitcher.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const lang = e.target.dataset.lang;
            if (lang) updateLanguage(lang);
        }
    });
    
    criticalButtons.addEventListener('click', e => {
        const button = e.target.closest('button');
        if (button && button.dataset.key) {
            const currentLang = document.documentElement.getAttribute('data-current-lang') || 'pt';
            const prompt = translations[currentLang].prompts[button.dataset.key];
            getEmergencyHelp(prompt);
        }
    });
    
    backToMainBtn.addEventListener('click', () => {
        resultsContainer.classList.add('hidden');
        mainView.classList.remove('hidden');
        backToMainBtn.classList.add('hidden');
        responseContent.innerHTML = '';
    });

    async function getEmergencyHelp(userPrompt) {
        const currentLang = document.documentElement.getAttribute('data-current-lang') || 'pt';
        const loadingText = translations[currentLang].loading;
        const errorTitleText = translations[currentLang].errorTitle;
        const errorMessageText = translations[currentLang].errorMessage;

        mainView.classList.add('hidden');
        resultsContainer.classList.remove('hidden');
        backToMainBtn.classList.remove('hidden');
        responseContent.innerHTML = `<div class="loader mx-auto my-8"></div><p class="text-center font-semibold text-gray-600">${loadingText}</p>`;

        try {
            const response = await fetch('https://missioncareplus-jca0.onrender.com/api/v1/assistente', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: userPrompt })
            });

            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            
            const data = await response.json();
            if (data.response) {
                 responseContent.innerHTML = window.marked.parse(data.response);
            } else {
                 throw new Error("Unexpected API response format.");
            }

        } catch (error) {
            console.error('Fetch error:', error);
            responseContent.innerHTML = `<div class="text-center p-4 bg-red-100 text-red-800 rounded-lg"><p class="font-bold">${errorTitleText}</p><p>${errorMessageText}</p></div>`;
        }
    }
    
    // Set initial language based on browser or default to 'pt'
    const initialLang = localStorage.getItem('preferredLang') || 'pt';
    updateLanguage(initialLang);
});
</script>

</body>
</html>
